from version_builder import formatter, version_info


class TestFormatter:
    def test_output_cpp(self):
        expected = """
// ---------------------------------------------------
// This file is autogenerated.
// DO NOT MODIFY!
// ---------------------------------------------------

#pragma once
#ifndef PLXSVERSION_VERSION_HPP
#define PLXSVERSION_VERSION_HPP

namespace version {
  constexpr const char *VERSION_STRING = "tagname.dev2+rev230abc-modified";
  constexpr const char *GIT_TAG_NAME = "tagname";
  constexpr const unsigned int GIT_COMMITS_SINCE_TAG = 2;
  constexpr const char *GIT_COMMIT_ID = "230abc";
  constexpr bool MODIFIED_SINCE_COMMIT = true;
  constexpr bool IS_DEV_VERSION = true;

}

#endif
"""
        actual = formatter.to_cpp(version_info.VersionInfo("tagname", 2, "230abc", True, True))
        assert expected == actual

    def test_output_cpp_with_components(self):
        expected = """
// ---------------------------------------------------
// This file is autogenerated.
// DO NOT MODIFY!
// ---------------------------------------------------

#pragma once
#ifndef PLXSVERSION_VERSION_HPP
#define PLXSVERSION_VERSION_HPP

namespace version {
  constexpr const char *VERSION_STRING = "1.2.3-MyMilestone.dev2+rev230abc-modified";
  constexpr const char *GIT_TAG_NAME = "1.2.3-MyMilestone";
  constexpr const unsigned int GIT_COMMITS_SINCE_TAG = 2;
  constexpr const char *GIT_COMMIT_ID = "230abc";
  constexpr bool MODIFIED_SINCE_COMMIT = true;
  constexpr bool IS_DEV_VERSION = true;

  constexpr const char *VERSION_COMPONENTS[] = {"1", "2", "3"};
  constexpr const char *VERSION_TAG = "MyMilestone";

}

#endif
"""
        actual = formatter.to_cpp(version_info.VersionInfo("1.2.3-MyMilestone", 2, "230abc", True, True))
        assert expected == actual

    def test_output_c(self):
        expected = """
// ---------------------------------------------------
// This file is autogenerated.
// DO NOT MODIFY!
// ---------------------------------------------------

#pragma once
#ifndef PLXSVERSION_VERSION_H
#define PLXSVERSION_VERSION_H

#include <stdbool.h>

#ifdef __cplusplus
extern "C" {
#endif

static const char *VERSION_STRING = "tagname.dev2+rev230abc-modified";
static const char *GIT_TAG_NAME = "tagname";
static const unsigned int GIT_COMMITS_SINCE_TAG = 2;
static const char *GIT_COMMIT_ID = "230abc";
static bool MODIFIED_SINCE_COMMIT = true;
static bool IS_DEV_VERSION = true;

#ifdef __cplusplus
} // extern "C"
#endif

#endif
"""
        actual = formatter.to_c(version_info.VersionInfo("tagname", 2, "230abc", True, True))
        assert expected == actual

    def test_output_c_with_components(self):
        expected = """
// ---------------------------------------------------
// This file is autogenerated.
// DO NOT MODIFY!
// ---------------------------------------------------

#pragma once
#ifndef PLXSVERSION_VERSION_H
#define PLXSVERSION_VERSION_H

#include <stdbool.h>

#ifdef __cplusplus
extern "C" {
#endif

static const char *VERSION_STRING = "1.2.3-MyMilestone.dev2+rev230abc-modified";
static const char *GIT_TAG_NAME = "1.2.3-MyMilestone";
static const unsigned int GIT_COMMITS_SINCE_TAG = 2;
static const char *GIT_COMMIT_ID = "230abc";
static bool MODIFIED_SINCE_COMMIT = true;
static bool IS_DEV_VERSION = true;

static const char *VERSION_COMPONENTS[] = {"1", "2", "3"};
static const char *VERSION_TAG = "MyMilestone";

#ifdef __cplusplus
} // extern "C"
#endif

#endif
"""
        actual = formatter.to_c(version_info.VersionInfo("1.2.3-MyMilestone", 2, "230abc", True, True))
        assert expected == actual
